<div class="page-header">
    <button nz-button nzType="default" (click)="goBack()">
        <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
        {{'shared.back' | translate}}
    </button>
    <h1>{{'transactions_list.transactions_list' | translate}}</h1>
    <div></div>
</div>

<div class="content elevated">
    <div class="filters" *ngIf="transactionsFacade.filters$ | async as filters">
        <div class="left">
            <nz-select [nzPlaceHolder]="'transactions_list.bank_account' | translate" [ngModel]="filters.bankAccountNumber" (ngModelChange)="onBankAccountNumberChange($event)">
                <nz-option *ngFor="let account of bankAccountsFacade.userBankAccounts$ | async" [nzValue]="account.accountNumber" [nzLabel]="account.accountNumber | mask: TransactionsConstants.accountNumberMask"></nz-option>
            </nz-select>
            <nz-select [nzPlaceHolder]="'transactions_list.transaction_type' | translate" nzMode="multiple" [ngModel]="filters.transactionTypes" (ngModelChange)="onTransactionTypesChange($event)">
                <nz-option [nzValue]="TransactionType.Incoming" [nzLabel]="'transaction_type.incoming' | translate"></nz-option>
                <nz-option [nzValue]="TransactionType.Outcoming" [nzLabel]="'transaction_type.outcoming' | translate"></nz-option>
            </nz-select>
            <nz-date-picker [ngModel]="filters.dateFrom" (ngModelChange)="onDateFromChange($event)" nzInputReadOnly="true" nzFormat="dd.MM.yyyy" [nzPlaceHolder]="'transactions_list.date_from' | translate"></nz-date-picker>
            <nz-date-picker [ngModel]="filters.dateTo" (ngModelChange)="onDateToChange($event)" nzInputReadOnly="true" nzFormat="dd.MM.yyyy" [nzPlaceHolder]="'transactions_list.date_to' | translate"></nz-date-picker>
        </div>
        <div class="right">
            <input class="text-filter" nz-input [placeholder]="'transactions_list.search_title_description' | translate" [ngModel]="filters.searchBy" (ngModelChange)="onSearchByChange($event)">
        </div>
    </div>

    <hr>

    <div class="table" *ngIf="transactionsFacade.transactions$ | async as transactions">
        <ng-container *ngIf="transactionsFacade.paginationParams$ | async as paginationParams">
            <nz-table #table 
                    nzShowSizeChanger
                    nzBordered
                    [nzData]="transactions" 
                    [nzFrontPagination]="false" 
                    [nzTotal]="paginationParams.totalRecords"
                    [nzPageIndex]="paginationParams.currentPage"
                    [nzPageSize]="paginationParams.pageSize"
                    [nzPageSizeOptions]="TransactionsConstants.pageSizeOptions"
                    (nzQueryParams)="onTableParamsChange($event)"
                    [nzLoading]="transactionsFacade.isTableLoading$ | async">
                <thead>
                    <tr>
                        <th nzWidth="290px">{{'transactions_list.sender_or_receiver' | translate}}</th>
                        <th nzColumnKey="Title" [nzSortFn]="true" [nzFilterMultiple]="false" nzWidth="225px">{{'transactions_list.title' | translate}}</th>
                        <th nzColumnKey="Description" [nzSortFn]="true" [nzFilterMultiple]="false">{{'transactions_list.description' | translate}}</th>
                        <th nzColumnKey="Date" [nzSortFn]="true" [nzFilterMultiple]="false" nzWidth="175px">{{'transactions_list.transaction_date' | translate}}</th>
                        <th nzColumnKey="Amount" [nzSortFn]="true" [nzFilterMultiple]="false" nzWidth="150px">{{'transactions_list.amount' | translate}}</th>
                        <th nzColumnKey="TransactionType" [nzSortFn]="true" [nzFilterMultiple]="false" nzWidth="150px">{{'transactions_list.transaction_type' | translate}}</th>
                        <th nzWidth="40px"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let transaction of table.data">
                        <td>{{transaction.accountNumberFrom | mask: TransactionsConstants.accountNumberMask}}</td>
                        <td>{{transaction.title}}</td>
                        <td>{{transaction.description}}</td>
                        <td>{{transaction.date | date:'dd.MM.yyyy HH:mm:ss'}}</td>
                        <td>{{transaction.amount | mask:"separator.2"}} z≈Ç</td>
                        <td>{{transaction.transactionType === TransactionType.Incoming ? ('transaction_type.incoming' | translate) : ('transaction_type.outcoming' | translate)}}</td>
                        <td class="button-column">
                            <span nz-icon nzType="cloud-download" nzTheme="outline" (click)="transactionsFacade.downloadConfirmation(transaction.id)"></span>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </ng-container>
    </div>
</div>
